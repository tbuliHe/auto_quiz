name: Deploy Auto Quiz

on:
  push:
    branches:
      - master  # 仅在推送到 main 分支时触发

jobs:
  deploy:
    runs-on: ubuntu-latest  # 使用最新版本的 Ubuntu 作为运行环境

    steps:
      # 1. 检出代码
      - name: Checkout code
        uses: actions/checkout@v2

      # 2. 设置 Python 环境
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'  # 指定 Python 版本

      # 3. 安装后端依赖
      - name: Install backend dependencies
        run: |
          cd backend
          pip install -r requirements.txt

      # 4. 启动后端服务（后台运行）
      - name: Start backend
        run: |
          cd backend
          gunicorn --bind 0.0.0.0:5000 app:app &
        background: true

      # 5. 设置 Node.js 环境
      - name: Set up Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'  # 指定 Node.js 版本

      # 6. 安装前端依赖
      - name: Install frontend dependencies
        run: |
          cd frontend
          npm install

      # 7. 构建前端项目
      - name: Build frontend
        run: |
          cd frontend
          npm run build

      # 8. 启动前端服务（后台运行）
      - name: Start frontend
        run: |
          cd frontend
          npm start &
        background: true

      # 9. 添加额外步骤（例如运行测试）
      - name: Run tests
        run: |
          cd backend
          python -m pytest
